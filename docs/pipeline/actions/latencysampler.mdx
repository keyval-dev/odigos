---
title: "Latency Sampler"
sidebarTitle: "Latency Sampler"
---

The "Latency Sampler" Odigos Action can be used to sample based on the duration of the traces.

### Use Cases

#### Cost Reduction

- In large-scale systems, collecting every trace can be expensive. Tail sampling with latency policy allows you to focus on the most critical traces, reducing the overall volume of data sent for analysis. This helps you optimize your costs.


#### System Optimization

- By sampling traces that exceed a certain latency threshold, you can pinpoint the root cause of slowdowns and identify performance bottlenecks. This allows you to effectively target the components or services causing issues without being overwhelmed by the volume of trace data, optimizing your system for efficiency.


### Mechanism

The duration is determined by looking at the earliest start time and latest end time of a trace.
It's support two main senarios:

1. Setting `minimum_latency_threshold` will sample any request with a duration above this threshold.
2. Setting both `minimum_latency_threshold` and `maximum_latency_threshold` will sample only requests with latency between these two values.

- It is recommended to still capture a portion of the traces that were not sampled due to the addition of the Latency Sampler Action. You can achieve this by adding a [Probabilistic Sampler Action](probabilisticsampler). Configure the Probabilistic Sampler with the desired ratio to determine the percentage of these unsampled traces to capture.

### Basic Example

The basic example below shows how to sample all traces with latency greater than 100ms

Create a file named `latency-sampler.yaml` with the following content:

```yaml
apiVersion: actions.odigos.io/v1alpha1
kind: LatencySampler
metadata:
  name: example-latencysampler
  namespace: odigos-system
spec:
  actionName: "example-latencysampler-action"
  disabled: false
  minimum_latency_threshold: 100
  signals:
  - TRACES  
```

Apply the action to the cluster:

```bash
kubectl apply -f latency-sampler.yaml
```

### Full Action Options

The full list of options available for the "LatencySampler" action are:

- `minimum_latency_threshold` (required): Specifies the minimum latency in milliseconds; traces with latency below this threshold are ignored.

- `maximum_latency_threshold` (optional): Specifies the maximum latency in milliseconds; traces with latency exceeding this threshold are ignored. If not configured, traces won't be ignored for exceeding an upper boundary, and only the minimum threshold will be active.

- `signals` (required): An array with the signals that the processor will act on (`TRACES`).

- `actionName` (optional): Allows you to attach a meaningful name to the action for convenience. Odigos does not use or assume any meaning from this field.

- `notes` (optional): A free-form text field that allows you to attach notes to the action for convenience. Odigos does not use or assume any meaning from this field.

- `disabled` (optional): A boolean field that allows you to disable the action. When set to `true`, the action will not be executed. The default value is `false`.

### Notes

- Supports only traces.
- All spans in a trace will be either entirely dropped or entirely sampled.
- The latency sampler is represented as a policy in a tail-sampling processor.
- Adding this action causes a 30-second delay in sending the data.
- Traces with durations exceeding 30 seconds might not be sampled correctly.
